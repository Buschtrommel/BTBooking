var map=L.map("venueMap").setView([BTBooking.lat,BTBooking.lng],13);var marker=L.marker(L.latLng(BTBooking.lat,BTBooking.lng));L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'}).addTo(map);marker.addTo(map);function onMapClick(a){jQuery("#btb_address_lat").val(a.latlng.lat);jQuery("#btb_address_lon").val(a.latlng.lng);marker.setLatLng(a.latlng)}map.on("click",onMapClick);function getAddressCoords(){jQuery("#mapMessages").empty();jQuery("#locs_table").hide();jQuery("#locs_body").empty();var e=new Object();var b=new String(jQuery("#btb_address_number").val());b.trim();if(b){e.house_number=b}var f=new String(jQuery("#btb_address_street").val());f.trim();if(f){e.street=f}var a=new String(jQuery("#btb_address_zip").val());a.trim();if(a){e.zip=a}var d=new String(jQuery("#btb_address_city").val());d.trim();if(d){e.city=d}var c=new String(jQuery("#btb_address_country").val());c.trim();if(c){e.country=c.toLowerCase()}getAddressCoordsFromOSMNominatim(e)}function getAddressCoordsFromOSMNominatim(b){var d="https://nominatim.openstreetmap.org/search?json_callback=?";var c=new Object();c.format="json";c.addressdetails=1;var a=b.house_number+" "+b.street;if(a){c.street=a}if(b.zip){c.postalcode=b.zip}if(b.city){c.city=b.city}if(b.country){c.countrycodes=b.country}jQuery.getJSON(d,c).done(function(e){places=new Array();if(e.length){e.forEach(function(f){var g=new Object();g.lat=f.lat;g.lng=f.lon;g.house_number=f.address.house_number;g.street=f.address.road;g.city=f.address.city;g.zip=f.address.postcode;g.state=f.address.state;g.country=f.address.country;g.cc=f.address.country_code;places.push(g)})}processAddressData(places)}).fail(function(e){processAddressError("error",BTBooking.queryErrorMsg)})}function processAddressError(a,c){var b=new String();switch(a){case"error":b=btb_render_error_msg(c);break;default:b=btb_render_warning_msg(c);break}jQuery("#mapMessages").append(b)}function processAddressData(a){if(a.length){a.forEach(function(d,b){var c=[];var e=[];if(d.street){e.push(d.street)}if(d.house_number){e.push(d.house_number)}var f=[];f.push('<button type="button" class="button button_small" ','onclick="btb_choose_loc(this)" ',btb_create_data_attr("lat",d.lat),btb_create_data_attr("lng",d.lng),btb_create_data_attr("street",d.street),btb_create_data_attr("house-number",d.house_number),btb_create_data_attr("city",d.city),btb_create_data_attr("zip",d.zip),btb_create_data_attr("state",d.state),">",Number(b+1).toString(),"</button>");c.push('<tr style="text-align:left">',btb_render_table_data(f.join("")),btb_render_table_data(e.join(" ")),btb_render_table_data(d.city),btb_render_table_data(d.zip),btb_render_table_data(d.state),"</tr>");jQuery("#locs_body").append(c.join(""));jQuery("#locs_table").show()})}else{processAddressError("warning",BTBooking.nothingFoundMsg)}}function btb_render_error_msg(a){var b=[];b.push('<div class="error notice notice-error"><p>',a,"</div>");return b.join("")}function btb_render_warning_msg(a){var b=[];b.push('<div class="notice notice-warning"><p>',a,"</div>");return b.join("")}function btb_render_table_data(b){var c=[];var a=b?b:"";c.push("<td>",a,"</td>");return c.join("")}function btb_create_data_attr(a,c){var b=["data-"];b.push(a,'="');if(c){b.push(c)}b.push('" ');return b.join("")}function btb_choose_loc(c){var d=jQuery(c);var b=d.data("lat");var a=d.data("lng");jQuery("#btb_address_street").val(d.data("street"));jQuery("#btb_address_number").val(d.data("house-number"));jQuery("#btb_address_zip").val(d.data("zip"));jQuery("#btb_address_city").val(d.data("city"));jQuery("#btb_address_region").val(d.data("state"));jQuery("#btb_address_lat").val(b);jQuery("#btb_address_lon").val(a);marker.setLatLng([b,a]);map.setView([b,a])}jQuery("#search_address").on("click",getAddressCoords);jQuery("#btb_use_coordinates").on("change",function(){if(jQuery(this).prop("checked")){jQuery("#search_address").show();jQuery("#venueMap").show()}else{jQuery("#venueMap").hide();jQuery("#search_address").hide()}});